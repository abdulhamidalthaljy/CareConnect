{% extends 'layout.html' %} {% block title %}Dashboard - CareConnect{% endblock
%} {% block content %}
<div class="mb-6">
  <h1 class="text-3xl font-bold">Welcome back, {{ user.username }}!</h1>
  <p class="text-gray-600 mt-1">
    Overview of your recent activity and health data.
  </p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <div class="lg:col-span-2 space-y-6">
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-semibold mb-4">Profile</h2>
      <form
        action="{{ url_for('main.update_profile') }}"
        method="POST"
        class="space-y-4"
      >
        {{ form.csrf_token }}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700"
              >Full name</label
            >
            <input
              type="text"
              name="full_name"
              class="mt-1 block w-full border rounded-md p-2"
              value="{{ user.profile.full_name if user.profile else '' }}"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700"
              >Address</label
            >
            <input
              type="text"
              name="address"
              class="mt-1 block w-full border rounded-md p-2"
              value="{{ user.profile.address if user.profile else '' }}"
            />
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700"
            >Allergies</label
          >
          <input
            type="text"
            name="allergies"
            class="mt-1 block w-full border rounded-md p-2"
            value="{{ user.profile.allergies if user.profile else '' }}"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700"
            >Health history</label
          >
          <textarea
            name="health_history"
            class="mt-1 block w-full border rounded-md p-2"
            rows="4"
          >
{{ user.profile.health_history if user.profile else '' }}</textarea
          >
        </div>
        <div>
          <button
            type="submit"
            class="bg-green-600 text-white px-4 py-2 rounded-md"
          >
            Save Profile
          </button>
        </div>
      </form>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-semibold mb-4">My Medicines</h2>
      <form
        action="{{ url_for('main.add_medicine') }}"
        method="POST"
        class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-4"
      >
        {{ med_form.csrf_token }}
        <input
          type="text"
          name="name"
          placeholder="Medicine name"
          class="border p-2 rounded-md"
          required
        />
        <input
          type="text"
          name="dosage"
          placeholder="Dosage (e.g. 500mg)"
          class="border p-2 rounded-md"
        />
        <button
          type="submit"
          class="bg-blue-600 text-white px-3 py-2 rounded-md"
        >
          Add
        </button>
      </form>

      <div class="overflow-x-auto">
        <table class="w-full table-auto text-sm">
          <thead>
            <tr class="text-left text-gray-600">
              <th class="px-2 py-2">Name</th>
              <th class="px-2 py-2">Dosage</th>
              <th class="px-2 py-2">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for m in user.medicines %}
            <tr class="border-t">
              <td class="px-2 py-2">{{ m.name }}</td>
              <td class="px-2 py-2">{{ m.dosage }}</td>
              <td class="px-2 py-2">
                <form
                  action="{{ url_for('main.delete_medicine', med_id=m.id) }}"
                  method="POST"
                  style="display: inline"
                >
                  <input
                    type="hidden"
                    name="csrf_token"
                    value="{{ csrf_token() }}"
                  />
                  <button type="submit" class="text-red-600">Delete</button>
                </form>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="3" class="px-2 py-2">No medicines recorded.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-semibold mb-4">Export</h2>
      <div class="flex space-x-2">
        <a
          href="{{ url_for('main.export_excel') }}"
          class="bg-gray-800 text-white px-4 py-2 rounded-md"
          >Download Excel</a
        >
        <a
          href="{{ url_for('main.export_pdf') }}"
          class="bg-gray-700 text-white px-4 py-2 rounded-md"
          >Download PDF</a
        >
      </div>
    </div>
  </div>

  <aside class="space-y-6">
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold mb-3">Add Vital</h3>
      <div id="vital-message" class="mb-3"></div>
      <form id="vital-form" class="space-y-3">
        <div>
          <label class="block text-sm text-gray-700">Type</label>
          <select
            id="vital-type"
            class="mt-1 block w-full p-2 border rounded-md"
          >
            <option value="bp">Blood Pressure (bp)</option>
            <option value="sugar">Blood Sugar</option>
          </select>
        </div>
        <div>
          <label class="block text-sm text-gray-700">Value 1</label>
          <input
            id="vital-value1"
            class="mt-1 block w-full p-2 border rounded-md"
            placeholder="e.g. 120"
          />
        </div>
        <div>
          <label class="block text-sm text-gray-700">Value 2 (optional)</label>
          <input
            id="vital-value2"
            class="mt-1 block w-full p-2 border rounded-md"
            placeholder="e.g. 80"
          />
        </div>
        <div>
          <button
            type="submit"
            class="bg-blue-600 text-white px-4 py-2 rounded-md"
          >
            Add Vital
          </button>
        </div>
      </form>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold mb-3">Vitals Chart</h3>
      <canvas id="vitalsChart" width="400" height="250"></canvas>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold mb-3">Medical Files</h3>
      <form id="file-form" enctype="multipart/form-data" class="mb-4">
        <input
          type="file"
          id="file-input"
          name="file"
          accept=".pdf,.jpg,.jpeg,.png"
        />
        <button
          id="upload-btn"
          type="button"
          class="ml-2 bg-blue-600 text-white px-3 py-1 rounded-md"
        >
          Upload
        </button>
      </form>
      <div class="overflow-x-auto text-sm">
        <table class="w-full table-auto">
          <thead>
            <tr class="text-left text-gray-600">
              <th class="px-2 py-2">Filename</th>
              <th class="px-2 py-2">Uploaded</th>
              <th class="px-2 py-2">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for f in files %}
            <tr class="border-t">
              <td class="px-2 py-2">{{ f.original_filename }}</td>
              <td class="px-2 py-2">
                {{ f.upload_timestamp.strftime('%Y-%m-%d %H:%M') }}
              </td>
              <td class="px-2 py-2">
                <a
                  class="text-blue-600"
                  href="{{ url_for('main.download_file', file_id=f.id) }}"
                  >Download</a
                >
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </aside>
</div>

<div class="mt-6 bg-white rounded-lg shadow p-6">
  <h2 class="text-lg font-semibold mb-4">Recent Activities</h2>
  <ul class="list-disc pl-5 text-sm text-gray-700">
    {% for activity in user.activities %}
    <li>{{ activity }}</li>
    {% endfor %}
  </ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
{% endblock %}
